"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Koa = require("koa");
var log4js = require("log4js");
var config = require("./../app.config");
var uncaughtExceptionEventRegister_1 = require("./bootstarp/uncaughtExceptionEventRegister");
var loggerRegister_1 = require("./bootstarp/loggerRegister");
var validateRegister_1 = require("./bootstarp/validateRegister");
var mysqlRegister_1 = require("./bootstarp/mysqlRegister");
var httpClientRegister_1 = require("./bootstarp/httpClientRegister");
var controllerRegister_1 = require("./bootstarp/controllerRegister");
var middlewareRegister_1 = require("./bootstarp/middlewareRegister");
var routerRegister_1 = require("./bootstarp/routerRegister");
var env = process.env.NODE_ENV;
var app = new Koa();
var logger = log4js.getLogger('APP');
app.logger = logger;
app.config = config.app[env];
uncaughtExceptionEventRegister_1.default(app);
var loggerMiddleware = loggerRegister_1.default(app);
var validateMiddleware = validateRegister_1.default(app);
var controllerMiddleware = controllerRegister_1.default(app);
var mysqlMiddleware = mysqlRegister_1.default(app);
var httpClientMiddleware = httpClientRegister_1.default();
var _a = routerRegister_1.default(app), routesMiddleware = _a.routesMiddleware, allowedMethodsMiddleware = _a.allowedMethodsMiddleware;
middlewareRegister_1.default(app, loggerMiddleware, validateMiddleware, mysqlMiddleware, httpClientMiddleware, controllerMiddleware, routesMiddleware, allowedMethodsMiddleware);
var port = process.env.PORT || app.config.port;
app.listen(port, function () {
    logger.trace("\uD83C\uDF0E  Listening on port " + port + ". Open up http://localhost:" + port + "/ in your browser.");
});
